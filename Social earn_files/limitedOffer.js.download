// Initialize time; check local storage for time, if not there, start new 10 mins
const initializeTime = () => {

  const expiryInMins = 5
  const now = new Date()

  if(localStorage.getItem('limitedOfferExpiry') === null) {
    const newExpiry = now.setTime(now.getTime() + 1000 * 60 * expiryInMins)
    localStorage.setItem('limitedOfferExpiry', newExpiry)
  }

  const expiryTime = localStorage.getItem('limitedOfferExpiry')
  var diffInTime = (expiryTime - now.getTime()) / 1000

  if(diffInTime < 0) {
    const newExpiry = now.setTime(now.getTime() + 1000 * 60 * expiryInMins)
    localStorage.setItem('limitedOfferExpiry', newExpiry)
  }

  startTimer(diffInTime)
}

var timeInSecs;
var ticker;

const startTimer = secs => {
  timeInSecs = parseInt(secs);
  ticker = setInterval("tick()", 1000);
}

const tick = () => {
  var secs = timeInSecs;
  if (secs > 0) {
    timeInSecs--;
  }
  else {
    clearInterval(ticker);
    //startTimer(5*60); // 4 minutes in seconds
    initializeTime();
  }

  var mins = Math.floor(secs/60);
  secs %= 60;
  var pretty = ( (mins < 10) ? "0" : "" ) + mins + ":" + ( (secs < 10) ? "0" : "" ) + secs;

  document.getElementById("limitedOfferCountdown").innerHTML = pretty;
}

initializeTime();
//startTimer(5*60); // 4 minutes in seconds
